<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø­Ø±ÙŠØ± - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Cairo', sans-serif;
            background: #f5f7fa;
            color: #333;
        }
        
        /* Header */
        .header {
            background: #571c24;
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 24px;
        }
        
        .logo i {
            color: #ffd166;
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .btn {
            padding: 8px 15px;
            background: white;
            color: #571c24;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: #f8f9fa;
        }
        
        /* Container */
        .container {
            display: flex;
            min-height: calc(100vh - 70px);
        }
        
        /* Sidebar */
        .sidebar {
            width: 250px;
            background: white;
            box-shadow: -2px 0 10px rgba(0,0,0,0.05);
            padding: 20px 0;
        }
        
        .menu {
            list-style: none;
        }
        
        .menu-item {
            padding: 15px 25px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .menu-item:hover {
            background: #f8f9fa;
            border-right: 4px solid #571c24;
        }
        
        .menu-item.active {
            background: #f8f9fa;
            border-right: 4px solid #571c24;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            padding: 20px;
        }
        
        /* Content Box */
        .content-box {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        /* Page Header */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f2f5;
        }
        
        .page-title {
            color: #571c24;
            font-size: 24px;
        }
        
        /* Filters */
        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            flex: 1;
            min-width: 200px;
        }
        
        /* Table */
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th {
            background: #f8f9fa;
            padding: 12px;
            text-align: right;
            border-bottom: 2px solid #ddd;
            color: #571c24;
        }
        
        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }
        
        .data-table tr:hover {
            background: #f8f9fa;
        }
        
        /* Badges */
        .badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .badge-success {
            background: #d4edda;
            color: #155724;
        }
        
        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }
        
        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        /* Buttons */
        .action-btn {
            padding: 5px 10px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 2px;
            transition: all 0.3s;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .btn-primary {
            background: #571c24;
            color: white;
            border: none;
            padding: 10px 20px;
        }
        
        .btn-primary:hover {
            background: #4a1a1f;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .empty-state i {
            font-size: 50px;
            margin-bottom: 20px;
            color: #ddd;
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 30px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #571c24;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="logo">
            <i class="fas fa-mosque"></i>
            <span>Ù†Ø¸Ø§Ù… Ø­Ø±ÙŠØ±</span>
        </div>
        
        <div class="user-menu">
            <span>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒØŒ Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</span>
            <button class="btn" onclick="window.location.href='index.html'">
                <i class="fas fa-sign-out-alt"></i>
                Ø®Ø±ÙˆØ¬
            </button>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <ul class="menu">
                <li class="menu-item active" onclick="loadPage('dashboard')">
                    <i class="fas fa-tachometer-alt"></i>
                    Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                </li>
                
                <li class="menu-item" onclick="loadPage('products')">
                    <i class="fas fa-box"></i>
                    Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                </li>
                
                <li class="menu-item" onclick="loadPage('orders')">
                    <i class="fas fa-shopping-cart"></i>
                    Ø§Ù„Ø·Ù„Ø¨Ø§Øª
                </li>
                
                <li class="menu-item" onclick="loadPage('reports')">
                    <i class="fas fa-chart-bar"></i>
                    Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
                </li>
                
                <li class="menu-item" onclick="loadPage('settings')">
                    <i class="fas fa-cog"></i>
                    Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                </li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div id="contentContainer">
                <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø§Øª Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                <div class="content-box">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <!-- Firebase Storage SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>
  <script>
        // ========== ØªÙ‡ÙŠØ¦Ø© Firebase ==========
// ========== ØªÙ‡ÙŠØ¦Ø© Firebase ==========
const firebaseConfig = {
    apiKey: "AIzaSyCMoFpEmsjbYPjYAl_LEX8GjC5so8kn9-Y",
    authDomain: "harir-92e27.firebaseapp.com",
    projectId: "harir-92e27",
    storageBucket: "harir-92e27.firebasestorage.app",
    messagingSenderId: "787234689138",
    appId: "1:787234689138:web:1d91758ff0d5c1fa9f72eb",
    measurementId: "G-T0JQMQQYZE"
};

// ØªÙ‡ÙŠØ¦Ø© Firebase
let db, storage;
try {
    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
    }
    db = firebase.firestore();
    storage = firebase.storage();
    console.log('âœ… Firebase Ù…ØªØµÙ„ Ø¨Ù†Ø¬Ø§Ø­ Ù…Ø¹ Storage');
} catch (error) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Firebase:', error);
}
        // ========== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø© ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ ØµÙØ­Ø© Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø¬Ø§Ù‡Ø²Ø©');
            // ØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
            loadPage('dashboard');
        });
        
        // ========== Ø¯Ø§Ù„Ø© loadPage Ø§Ù„Ø¹Ø§Ù…Ø© ==========
        function loadPage(page) {
            console.log(`ğŸ“„ ØªØ­Ù…ÙŠÙ„ ØµÙØ­Ø©: ${page}`);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†Ø´Ø·Ø©
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©
            if (page === 'products') {
                loadProductsPage();
            } else if (page === 'dashboard') {
                loadDashboardPage();
            } else if (page === 'orders') {
                loadOrdersPage();
            } else if (page === 'reports') {
                loadReportsPage();
            } else if (page === 'settings') {
                loadSettingsPage();
            }
        }
        
        // ========== Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ==========
      // ÙÙŠ loadDashboardPage
function loadDashboardPage() {
    // Ø¬Ù„Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…Ù† Firebase
    getDashboardStats().then(stats => {
        const content = `
            <div class="content-box">
                <h2 class="page-title">
                    <i class="fas fa-tachometer-alt"></i>
                    Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                    <small style="font-size: 14px; color: #28a745; margin-right: 10px;">
                        <i class="fas fa-check-circle"></i> Ù…Ø³Ø¬Ù„ ÙƒÙ€ ${auth.currentUser?.email}
                    </small>
                </h2>
                
                <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0;">
                    <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                        <h3 style="font-size: 36px; margin-bottom: 10px;">${stats.totalProducts}</h3>
                        <p>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</p>
                        <small style="opacity: 0.8;">${stats.activeProducts} Ù†Ø´Ø·Ø©</small>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #f093fb, #f5576c); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                        <h3 style="font-size: 36px; margin-bottom: 10px;">${stats.totalOrders}</h3>
                        <p>Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p>
                        <small style="opacity: 0.8;">${stats.pendingOrders} Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</small>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #4facfe, #00f2fe); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                        <h3 style="font-size: 36px; margin-bottom: 10px;">${stats.totalRevenue} Ø¯.Ø£</h3>
                        <p>Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</p>
                        <small style="opacity: 0.8;">Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</small>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #43e97b, #38f9d7); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                        <h3 style="font-size: 36px; margin-bottom: 10px;">${stats.totalUsers}</h3>
                        <p>Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</p>
                        <small style="opacity: 0.8;">${stats.newUsers} Ø¬Ø¯Ø¯</small>
                    </div>
                </div>
                
                <!-- Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø£Ø®ÙŠØ± -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 30px;">
                    <h3 style="color: #571c24; margin-bottom: 15px;">
                        <i class="fas fa-history"></i>
                        Ø¢Ø®Ø± Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª
                    </h3>
                    <div id="recentActivity">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                    </div>
                </div>
            </div>
        `;
        
        document.getElementById('contentContainer').innerHTML = content;
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø£Ø®ÙŠØ±
        loadRecentActivity();
    });
}

// Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…Ù† Firebase
async function getDashboardStats() {
    try {
        const productsSnapshot = await db.collection('products').get();
        const ordersSnapshot = await db.collection('orders').get();
        
        const totalProducts = productsSnapshot.size;
        const activeProducts = productsSnapshot.docs.filter(doc => 
            doc.data().isActive !== false
        ).length;
        
        const totalOrders = ordersSnapshot.size;
        
        // ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        
        return {
            totalProducts,
            activeProducts,
            totalOrders,
            pendingOrders: 0, // ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§
            totalRevenue: '5,240',
            totalUsers: 8,
            newUsers: 2
        };
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:', error);
        return {
            totalProducts: 0,
            activeProducts: 0,
            totalOrders: 0,
            pendingOrders: 0,
            totalRevenue: '0',
            totalUsers: 0,
            newUsers: 0
        };
    }
}  // ========== ØµÙØ­Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ==========
        function loadProductsPage() {
            console.log('ğŸ“¦ ØªØ­Ù…ÙŠÙ„ ØµÙØ­Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...');
            
            const content = `
                <div class="content-box">
                    <div class="page-header">
                        <h2 class="page-title">
                            <i class="fas fa-box"></i>
                            Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                        </h2>
                        <button class="btn btn-primary" onclick="openAddProductForm()">
                            <i class="fas fa-plus"></i>
                            Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
                        </button>
                    </div>
                    
                    <!-- ÙÙ„ØªØ±Ø© -->
                    <div class="filters">
                        <input type="text" class="filter-input" id="searchProduct" placeholder="ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬...">
                        <select class="filter-input" id="filterCategory">
                            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</option>
                            <option value="Ø­Ø±ÙŠØ±">Ø­Ø±ÙŠØ±</option>
                            <option value="Ù‚Ø·Ù†">Ù‚Ø·Ù†</option>
                        </select>
                        <select class="filter-input" id="filterStore">
                            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØªØ§Ø¬Ø±</option>
                            <option value="Ø§Ù„Ø³Ù…Ø§Ø­">Ù…ØªØ¬Ø± Ø§Ù„Ø³Ù…Ø§Ø­</option>
                            <option value="Ø§Ù„ØªÙ‚Ù‰">Ù…ØªØ¬Ø± Ø§Ù„ØªÙ‚Ù‰</option>
                        </select>
                        <button class="btn btn-primary" onclick="searchProducts()">
                            <i class="fas fa-search"></i>
                            Ø¨Ø­Ø«
                        </button>
                    </div>
                    
                    <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</th>
                                    <th>Ø§Ù„Ø³Ø¹Ø±</th>
                                    <th>Ø§Ù„ØªØµÙ†ÙŠÙ</th>
                                    <th>Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</th>
                                    <th>Ø§Ù„Ù…ØªØ¬Ø±</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="productsTableBody">
                                <!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Ø±Ø³Ø§Ù„Ø© Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù…Ù†ØªØ¬Ø§Øª -->
                    <div id="noProductsMessage" class="empty-state" style="display: none;">
                        <i class="fas fa-box-open"></i>
                        <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</h3>
                        <p>Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ø¥Ù„Ù‰ Ù…ØªØ¬Ø±Ùƒ</p>
                        <button class="btn btn-primary" onclick="openAddProductForm()" style="margin-top: 20px;">
                            <i class="fas fa-plus"></i>
                            Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ù…Ù†ØªØ¬
                        </button>
                    </div>
                    
                    <!-- ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                    <div id="loadingProducts" class="loading">
                        <div class="spinner"></div>
                        <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...</p>
                    </div>
                </div>
            `;
            
            document.getElementById('contentContainer').innerHTML = content;
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯ Ø¹Ø±Ø¶ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            setTimeout(loadProductsData, 500);
        }
        
        // ========== ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ==========
     // ========== ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Firebase ==========
async function loadProductsData() {
    console.log('ğŸ“¥ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Firebase...');
    
    const loadingElement = document.getElementById('loadingProducts');
    const tableBody = document.getElementById('productsTableBody');
    const noProductsMessage = document.getElementById('noProductsMessage');
    
    try {
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Firebase
        if (!db) {
            throw new Error('Firebase ØºÙŠØ± Ù…ØªØµÙ„');
        }
        
        // Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Firestore
        const snapshot = await db.collection('products').get();
        
        // Ø¥Ø®ÙØ§Ø¡ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
        if (loadingElement) loadingElement.style.display = 'none';
        
        if (snapshot.empty) {
            console.log('ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            tableBody.innerHTML = '';
            noProductsMessage.style.display = 'block';
            return;
        }
        
        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ù…ØµÙÙˆÙØ©
        const products = [];
        snapshot.forEach(doc => {
            const productData = doc.data();
            products.push({
                id: doc.id,
                name: productData.name || 'ØºÙŠØ± Ù…Ø³Ù…Ù‰',
                description: productData.description || '',
                price: productData.price || 0,
                category: productData.category || 'ØºÙŠØ± Ù…ØµÙ†Ù',
                stock: productData.stock || 0,
                store: productData.store || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                image: productData.image || null,
                createdAt: productData.createdAt || new Date().toISOString()
            });
        });
        
        console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${products.length} Ù…Ù†ØªØ¬ Ù…Ù† Firebase`);
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
        displayProducts(products);
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Firebase:', error);
        
        if (loadingElement) {
            loadingElement.innerHTML = `
                <div style="color: red; text-align: center; padding: 20px;">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>âŒ ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
                    <p>${error.message}</p>
                    <button onclick="loadProductsData()" style="background: #571c24; color: white; padding: 10px 20px; border: none; border-radius: 5px; margin-top: 10px; cursor: pointer;">
                        <i class="fas fa-redo"></i>
                        Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
                    </button>
                </div>
            `;
        }
        
        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
        alert(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${error.message}`);
    }
}  
        // ========== Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ==========
      // ========== Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ==========
// ========== Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¹ Ø§Ù„ØµÙˆØ± ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ==========
// ========== Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¹ Ø§Ù„ØµÙˆØ± Ù…Ù† Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ==========
function displayProducts(products) {
    const tableBody = document.getElementById('productsTableBody');
    const noProductsMessage = document.getElementById('noProductsMessage');
    
    if (!products || products.length === 0) {
        tableBody.innerHTML = '';
        noProductsMessage.style.display = 'block';
        return;
    }
    
    noProductsMessage.style.display = 'none';
    
    // Ø¥Ù†Ø´Ø§Ø¡ ØµÙÙˆÙ Ø§Ù„Ø¬Ø¯ÙˆÙ„
    let tableHTML = '';
    
    products.forEach((product, index) => {
        // ØªØ­Ø¯ÙŠØ¯ Ù„ÙˆÙ† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
        let stockClass = 'badge-success';
        let stockText = 'Ù…ØªÙˆÙØ±';
        
        if (product.stock <= 0) {
            stockClass = 'badge-danger';
            stockText = 'Ù†ÙØ°';
        } else if (product.stock <= 10) {
            stockClass = 'badge-warning';
            stockText = 'Ù…Ø­Ø¯ÙˆØ¯';
        }
        
        // Ù„ÙˆÙ† Ø§Ù„Ù…ØªØ¬Ø±
        const storeClass = (product.store || '').includes('Ø§Ù„Ø³Ù…Ø§Ø­') ? 'badge-info' : 'badge-success';
        const storeName = product.store || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        
        // ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· Ø£Ùˆ ØµÙˆØ±Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        let productImageHTML = '';
        if (product.imageUrl && product.imageUrl.startsWith('http')) {
            productImageHTML = `
                <div style="position: relative;">
                    <img src="${product.imageUrl}" 
                         alt="${product.name}" 
                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px; border: 1px solid #ddd;"
                         onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHJ4PSI4IiBmaWxsPSIjZjBmMGYwIi8+PHBhdGggZD0iTTMwIDI2QzMzLjMxMzcgMjYgMzYgMjMuMzEzNyAzNiAyMEMzNiAxNi42ODYzIDMzLjMxMzcgMTQgMzAgMTRDMjYuNjg2MyAxNCAyNCAxNi42ODYzIDI0IDIwQzI0IDIzLjMxMzcgMjYuNjg2MyAyNiAzMCAyNlpNMjQgMzRIMzZDMzggMjQgNDggMjQgNDggMzRINDhDNDggNDMuOTUzIDM5Ljk1MyA1MiAzMCA1MkMyMC4wNDcgNTIgMTIgNDMuOTUzIDEyIDM0SDEyQzEyIDI0IDIyIDI0IDI0IDM0WiIgZmlsbD0iIzk5OSIvPjwvc3ZnPg==';"
                         onload="this.style.opacity='1'"
                         style="opacity: 0; transition: opacity 0.3s;">
                    <div class="image-overlay" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0); border-radius: 8px; transition: background 0.3s; display: flex; align-items: center; justify-content: center; opacity: 0;">
                        <i class="fas fa-search-plus" style="color: white; font-size: 20px;"></i>
                    </div>
                </div>
            `;
        } else {
            productImageHTML = `
                <div style="width: 60px; height: 60px; background: #f0f0f0; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #999; position: relative;">
                    <i class="fas fa-image" style="font-size: 24px;"></i>
                    <div class="image-overlay" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0); border-radius: 8px; transition: background 0.3s; display: flex; align-items: center; justify-content: center; opacity: 0;">
                        <i class="fas fa-plus" style="color: white; font-size: 20px;"></i>
                    </div>
                </div>
            `;
        }
        
        tableHTML += `
            <tr>
                <td>${index + 1}</td>
                <td>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div class="product-image-container" 
                             style="position: relative; cursor: pointer;" 
                             onclick="${product.imageUrl ? `showLargeImage('${product.imageUrl}', '${product.name}')` : 'openAddProductForm()'}">
                            ${productImageHTML}
                        </div>
                        <div style="flex: 1;">
                            <strong style="display: block; margin-bottom: 5px; color: #571c24;">${product.name}</strong>
                            <small style="color: #666; display: block; line-height: 1.4;">${product.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ'}</small>
                            ${product.code ? `<small style="color: #888; display: block; margin-top: 3px;">ÙƒÙˆØ¯: ${product.code}</small>` : ''}
                        </div>
                    </div>
                </td>
                <td style="font-weight: bold; color: #571c24; vertical-align: middle;">
                    ${parseFloat(product.price || 0).toFixed(2)} Ø¯.Ø£
                </td>
                <td style="vertical-align: middle;">
                    <span class="badge" style="background: #e8f4f8; color: #2c3e50; padding: 6px 12px; border-radius: 20px;">
                        ${product.category}
                    </span>
                </td>
                <td style="vertical-align: middle;">
                    <span class="badge ${stockClass}" style="padding: 6px 12px; border-radius: 20px;">
                        ${product.stock} (${stockText})
                    </span>
                </td>
                <td style="vertical-align: middle;">
                    <span class="badge ${storeClass}" style="padding: 6px 12px; border-radius: 20px;">
                        ${storeName}
                    </span>
                </td>
                <td style="vertical-align: middle;">
                    <div style="display: flex; gap: 8px;">
                        <button class="action-btn" onclick="viewProduct('${product.id}')" title="Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„">
                            <i class="fas fa-eye" style="color: #17a2b8;"></i>
                        </button>
                        <button class="action-btn" onclick="editProduct('${product.id}')" title="ØªØ¹Ø¯ÙŠÙ„">
                            <i class="fas fa-edit" style="color: #6c757d;"></i>
                        </button>
                        <button class="action-btn" onclick="deleteProduct('${product.id}', '${product.name}')" title="Ø­Ø°Ù">
                            <i class="fas fa-trash" style="color: #dc3545;"></i>
                        </button>
                    </div>
                </td>
            </tr>
        `;
    });
    
    tableBody.innerHTML = tableHTML;
    
    // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± hover Ù„Ù„ØµÙˆØ±
    setTimeout(() => {
        document.querySelectorAll('.product-image-container').forEach(container => {
            const overlay = container.querySelector('.image-overlay');
            if (overlay) {
                container.addEventListener('mouseenter', () => {
                    overlay.style.background = 'rgba(87, 28, 36, 0.7)';
                    overlay.style.opacity = '1';
                });
                container.addEventListener('mouseleave', () => {
                    overlay.style.background = 'rgba(0,0,0,0)';
                    overlay.style.opacity = '0';
                });
            }
        });
    }, 100);
}

// ========== Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø­Ø¬Ù… ÙƒØ¨ÙŠØ± ==========
function showLargeImage(imageUrl, productName) {
    const modalHTML = `
        <div id="imageModal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; align-items: center; justify-content: center; padding: 20px;">
            <div style="background: white; border-radius: 10px; max-width: 90%; max-height: 90%; position: relative;">
                <button onclick="closeImageModal()" style="position: absolute; top: -40px; left: 50%; transform: translateX(-50%); background: white; border: none; width: 40px; height: 40px; border-radius: 50%; font-size: 20px; cursor: pointer; box-shadow: 0 2px 10px rgba(0,0,0,0.2);">
                    <i class="fas fa-times"></i>
                </button>
                <div style="padding: 20px; text-align: center;">
                    <h4 style="color: #571c24; margin-bottom: 15px;">${productName}</h4>
                    <img src="${imageUrl}" alt="${productName}" 
                         style="max-width: 100%; max-height: 70vh; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.2);">
                    <div style="margin-top: 15px;">
                        <a href="${imageUrl}" target="_blank" 
                           style="display: inline-block; background: #571c24; color: white; padding: 8px 15px; border-radius: 5px; text-decoration: none; margin: 0 5px;">
                            <i class="fas fa-external-link-alt"></i>
                            ÙØªØ­ ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø©
                        </a>
                        <button onclick="copyImageUrl('${imageUrl}')" 
                                style="background: #17a2b8; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin: 0 5px;">
                            <i class="fas fa-copy"></i>
                            Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù€ Modal Ø¥Ù„Ù‰ Ø§Ù„Ø¬Ø³Ù…
    const modalDiv = document.createElement('div');
    modalDiv.innerHTML = modalHTML;
    document.body.appendChild(modalDiv);
    
    // Ø¥ØºÙ„Ø§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Escape
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeImageModal();
        }
    });
}

// ========== Ø¥ØºÙ„Ø§Ù‚ ØµÙˆØ±Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ¨ÙŠØ±Ø© ==========
function closeImageModal() {
    const modal = document.getElementById('imageModal');
    if (modal) {
        modal.remove();
    }
}

// ========== Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© ==========
function copyImageUrl(imageUrl) {
    navigator.clipboard.writeText(imageUrl)
        .then(() => {
            alert('âœ… ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©');
        })
        .catch(err => {
            console.error('âŒ ÙØ´Ù„ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·:', err);
            alert('âŒ ÙØ´Ù„ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·');
        });
}  // ========== Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ==========
        function openAddProductForm() {
            alert('ğŸ“ Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯');
            // ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ù†Ù…ÙˆØ°Ø¬ Ø­Ù‚ÙŠÙ‚ÙŠ Ù‡Ù†Ø§
        }
        
        function searchProducts() {
            const searchTerm = document.getElementById('searchProduct').value;
            const category = document.getElementById('filterCategory').value;
            const store = document.getElementById('filterStore').value;
            
            alert(`ğŸ” Ø¨Ø­Ø« Ø¹Ù†: "${searchTerm}"\nØ§Ù„ØªØµÙ†ÙŠÙ: ${category || 'Ø§Ù„ÙƒÙ„'}\nØ§Ù„Ù…ØªØ¬Ø±: ${store || 'Ø§Ù„ÙƒÙ„'}`);
            
            // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ÙØ¹Ù„ÙŠ
        }
        
        function editProduct(id) {
            alert(`âœï¸ ØªØ­Ø±ÙŠØ± Ø§Ù„Ù…Ù†ØªØ¬ Ø±Ù‚Ù… ${id}`);
            // ÙŠÙ…ÙƒÙ†Ùƒ ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ­Ø±ÙŠØ± Ù‡Ù†Ø§
        }
        
        function deleteProduct(id) {
            if (confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ Ø±Ù‚Ù… ${id}ØŸ`)) {
                alert(`ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ Ø±Ù‚Ù… ${id} (Ù‡Ø°Ø§ Ù…Ø¬Ø±Ø¯ Ø¹Ø±Ø¶ ØªØ¬Ø±ÙŠØ¨ÙŠ)`);
                // ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ Ø§Ù„Ø­Ø°Ù Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù‡Ù†Ø§
            }
        }
        
        function viewProduct(id) {
            alert(`ğŸ‘ï¸ Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ Ø±Ù‚Ù… ${id}`);
            // ÙŠÙ…ÙƒÙ†Ùƒ ÙØªØ­ ØµÙØ­Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ Ù‡Ù†Ø§
        }
        // ========== Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯ ==========
// ========== Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯ Ù…Ø¹ ØµÙˆØ±Ø© ==========
// ========== Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯ Ù…Ø¹ Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© ==========
async function openAddProductForm() {
    const formHTML = `
        <div style="background: white; padding: 30px; border-radius: 10px; max-width: 800px; margin: 0 auto;">
            <h3 style="color: #571c24; margin-bottom: 20px;">
                <i class="fas fa-plus-circle"></i>
                Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
            </h3>
            
            <form id="addProductForm">
                <!-- Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© -->
                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #571c24;">
                        <i class="fas fa-image"></i>
                        Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ (Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª)
                    </label>
                    <div style="display: flex; gap: 10px; align-items: flex-start;">
                        <input type="url" id="productImageUrl" 
                               placeholder="https://example.com/image.jpg"
                               style="flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px;">
                        <button type="button" onclick="testImageUrl()" 
                                style="padding: 12px 20px; background: #17a2b8; color: white; border: none; border-radius: 8px; cursor: pointer;">
                            <i class="fas fa-search"></i>
                            Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø±Ø§Ø¨Ø·
                        </button>
                    </div>
                    <small style="color: #888; display: block; margin-top: 5px;">
                        Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª (Ù…Ø«Ù„: https://cdn.pixabay.com/photo/...)
                    </small>
                    
                    <!-- Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø© -->
                    <div id="imagePreviewContainer" style="margin-top: 15px; display: none;">
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <p style="margin: 0 0 10px 0; font-weight: bold; color: #571c24;">
                                <i class="fas fa-eye"></i>
                                Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©:
                            </p>
                            <div id="imagePreview" style="text-align: center;">
                                <!-- Ø§Ù„ØµÙˆØ±Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬ -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #571c24;">
                            <i class="fas fa-tag"></i>
                            Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ *
                        </label>
                        <input type="text" id="productName" required 
                               style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px;"
                               placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
                    </div>
                    
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #571c24;">
                            <i class="fas fa-money-bill-wave"></i>
                            Ø§Ù„Ø³Ø¹Ø± (Ø¯.Ø£) *
                        </label>
                        <input type="number" id="productPrice" step="0.01" required 
                               style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px;"
                               placeholder="Ø§Ù„Ø³Ø¹Ø± Ø¨Ø§Ù„Ø¯ÙŠÙ†Ø§Ø±">
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #571c24;">
                        <i class="fas fa-align-left"></i>
                        ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬
                    </label>
                    <textarea id="productDescription" rows="4" 
                              style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px;"
                              placeholder="Ø£Ø¯Ø®Ù„ ÙˆØµÙØ§Ù‹ Ù„Ù„Ù…Ù†ØªØ¬"></textarea>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #571c24;">
                            <i class="fas fa-layer-group"></i>
                            Ø§Ù„ØªØµÙ†ÙŠÙ *
                        </label>
                        <select id="productCategory" required 
                                style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px;">
                            <option value="">Ø§Ø®ØªØ± ØªØµÙ†ÙŠÙØ§Ù‹</option>
                            <option value="Ø­Ø±ÙŠØ±">Ø­Ø±ÙŠØ±</option>
                            <option value="Ù‚Ø·Ù†">Ù‚Ø·Ù†</option>
                            <option value="ØµÙˆÙ">ØµÙˆÙ</option>
                            <option value="Ø®ÙŠØ·Ø§Ù†">Ø®ÙŠØ·Ø§Ù†</option>
                            <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
                        </select>
                    </div>
                    
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #571c24;">
                            <i class="fas fa-store"></i>
                            Ø§Ù„Ù…ØªØ¬Ø± *
                        </label>
                        <select id="productStore" required 
                                style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px;">
                            <option value="">Ø§Ø®ØªØ± Ù…ØªØ¬Ø±Ø§Ù‹</option>
                            <option value="Ù…ØªØ¬Ø± Ø§Ù„Ø³Ù…Ø§Ø­">Ù…ØªØ¬Ø± Ø§Ù„Ø³Ù…Ø§Ø­</option>
                            <option value="Ù…ØªØ¬Ø± Ø§Ù„ØªÙ‚Ù‰">Ù…ØªØ¬Ø± Ø§Ù„ØªÙ‚Ù‰</option>
                        </select>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #571c24;">
                            <i class="fas fa-boxes"></i>
                            Ø§Ù„ÙƒÙ…ÙŠØ© ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† *
                        </label>
                        <input type="number" id="productStock" required 
                               style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px;"
                               placeholder="Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø©">
                    </div>
                    
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #571c24;">
                            <i class="fas fa-barcode"></i>
                            ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <input type="text" id="productCode" 
                               style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px;"
                               placeholder="ÙƒÙˆØ¯ Ø£Ùˆ SKU">
                    </div>
                </div>
                
                <!-- Ø£Ø²Ø±Ø§Ø± -->
                <div style="display: flex; gap: 15px; margin-top: 30px;">
                    <button type="button" onclick="closeForm()" 
                            style="flex: 1; padding: 15px; background: #f8f9fa; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold;">
                        <i class="fas fa-times"></i>
                        Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button type="submit" id="submitBtn"
                            style="flex: 2; padding: 15px; background: linear-gradient(135deg, #571c24, #752a34); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold;">
                        <i class="fas fa-save"></i>
                        Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬
                    </button>
                </div>
            </form>
        </div>
    `;
    
    // Ø¹Ø±Ø¶ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    document.getElementById('contentContainer').innerHTML = formHTML;
    
    // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„Ù„Ù†Ù…ÙˆØ°Ø¬
    document.getElementById('addProductForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        await addProductToFirebase();
    });
}

// ========== Ø§Ø®ØªØ¨Ø§Ø± Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© ==========
function testImageUrl() {
    const imageUrl = document.getElementById('productImageUrl').value.trim();
    const previewContainer = document.getElementById('imagePreviewContainer');
    const previewDiv = document.getElementById('imagePreview');
    
    if (!imageUrl) {
        alert('âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹');
        return;
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ¨Ø¯Ø£ Ø¨Ù€ http:// Ø£Ùˆ https://
    if (!imageUrl.startsWith('http://') && !imageUrl.startsWith('https://')) {
        alert('âŒ Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ§Ù„Ø­! Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ http:// Ø£Ùˆ https://');
        return;
    }
    
    // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
    const img = new Image();
    
    img.onload = function() {
        // Ø§Ù„ØµÙˆØ±Ø© ØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡Ø§ Ø¨Ù†Ø¬Ø§Ø­
        previewDiv.innerHTML = `
            <div style="margin-bottom: 10px;">
                <p style="color: #28a745; margin: 0 0 10px 0;">
                    <i class="fas fa-check-circle"></i>
                    Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­! Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯: ${img.width} Ã— ${img.height} Ø¨ÙƒØ³Ù„
                </p>
                <img src="${imageUrl}" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©" 
                     style="max-width: 100%; max-height: 200px; border-radius: 8px; border: 1px solid #ddd;">
            </div>
        `;
        previewContainer.style.display = 'block';
    };
    
    img.onerror = function() {
        // ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
        previewDiv.innerHTML = `
            <div style="color: #dc3545; text-align: center; padding: 20px; background: #f8d7da; border-radius: 8px;">
                <i class="fas fa-exclamation-triangle"></i>
                <p style="margin: 10px 0;">âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©!</p>
                <p style="margin: 0; font-size: 14px;">Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· Ø£Ùˆ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø£Ø®Ø±Ù‰</p>
            </div>
        `;
        previewContainer.style.display = 'block';
    };
    
    // Ø¥Ø¶Ø§ÙØ© Ù…Ø¤Ø´Ø± ØªØ­Ù…ÙŠÙ„
    previewDiv.innerHTML = `
        <div style="text-align: center; padding: 20px;">
            <div class="spinner" style="width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #571c24; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 15px;"></div>
            <p style="margin: 0; color: #571c24;">Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©...</p>
        </div>
    `;
    previewContainer.style.display = 'block';
    
    // Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
    img.src = imageUrl;
} 
// ========== Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø±ÙØ¹ ==========
function previewImage(event) {
    const input = event.target;
    const fileNameElement = document.getElementById('fileName');
    const previewPlaceholder = document.getElementById('previewPlaceholder');
    const previewImage = document.getElementById('previewImage');
    
    if (input.files && input.files[0]) {
        const file = input.files[0];
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© (Ø£Ù‚ØµÙ‰ 2MB)
        if (file.size > 2 * 1024 * 1024) {
            alert('âŒ Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹! Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 2MB');
            input.value = '';
            return;
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†ÙˆØ¹ Ø§Ù„ØµÙˆØ±Ø©
        const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
        if (!validTypes.includes(file.type)) {
            alert('âŒ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…! ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© (JPG, PNG, GIF)');
            input.value = '';
            return;
        }
        
        // Ø¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù
        fileNameElement.textContent = file.name;
        
        // Ø¹Ø±Ø¶ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©
        const reader = new FileReader();
        reader.onload = function(e) {
            previewPlaceholder.style.display = 'none';
            previewImage.src = e.target.result;
            previewImage.style.display = 'block';
        }
        reader.readAsDataURL(file);
    }
}
// ========== Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Firebase ==========
// ========== Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ù…Ø¹ ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Firebase ==========
// ========== Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ù…Ø¹ Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Firebase ==========
async function addProductToFirebase() {
    const submitBtn = document.getElementById('submitBtn');
    
    try {
        if (!db) {
            throw new Error('Firebase ØºÙŠØ± Ù…ØªØµÙ„');
        }
        
        // ØªØ¹Ø·ÙŠÙ„ Ø²Ø± Ø§Ù„Ø­ÙØ¸
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
        
        // Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        const productData = {
            name: document.getElementById('productName').value.trim(),
            description: document.getElementById('productDescription').value.trim(),
            price: parseFloat(document.getElementById('productPrice').value) || 0,
            stock: parseInt(document.getElementById('productStock').value) || 0,
            category: document.getElementById('productCategory').value,
            store: document.getElementById('productStore').value,
            code: document.getElementById('productCode').value.trim(),
            imageUrl: document.getElementById('productImageUrl').value.trim(), // Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
        if (!productData.name || !productData.category || !productData.store) {
            throw new Error('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
        }
        
        console.log('ğŸ“ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬:', productData);
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Firestore
        const docRef = await db.collection('products').add(productData);
        
        console.log('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­:', docRef.id);
        
        // Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
        alert('ğŸ‰ ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­!');
        
        // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        loadProductsPage();
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬:', error);
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø±
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬';
        
        alert(`âŒ ÙØ´Ù„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬: ${error.message}`);
    }
}
// ========== ØªØ­Ø±ÙŠØ± Ù…Ù†ØªØ¬ Ù…Ø¹ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙˆØ±Ø© ==========
async function editProduct(productId) {
    try {
        if (!db) {
            throw new Error('Firebase ØºÙŠØ± Ù…ØªØµÙ„');
        }
        
        // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬
        const doc = await db.collection('products').doc(productId).get();
        
        if (!doc.exists) {
            alert('âŒ Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
            return;
        }
        
        const product = doc.data();
        
        // Ø¹Ø±Ø¶ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ­Ø±ÙŠØ±
        const formHTML = `
            <div style="background: white; padding: 30px; border-radius: 10px; max-width: 800px; margin: 0 auto;">
                <h3 style="color: #571c24; margin-bottom: 20px;">
                    <i class="fas fa-edit"></i>
                    ØªØ­Ø±ÙŠØ± Ø§Ù„Ù…Ù†ØªØ¬
                </h3>
                
                <form id="editProductForm">
                    <input type="hidden" id="editProductId" value="${productId}">
                    <input type="hidden" id="currentImageUrl" value="${product.imageUrl || ''}">
                    
                    <!-- Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø© -->
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div id="editImagePreview" style="width: 200px; height: 200px; border: 2px dashed #ddd; border-radius: 10px; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; overflow: hidden; background: #f8f9fa;">
                            ${product.imageUrl 
                                ? `<img src="${product.imageUrl}" alt="Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©" style="max-width: 100%; max-height: 100%;" id="editPreviewImage">`
                                : `<div id="editPreviewPlaceholder" style="text-align: center; color: #999;">
                                      <i class="fas fa-image" style="font-size: 50px; margin-bottom: 10px;"></i>
                                      <p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                                   </div>`
                            }
                        </div>
                        
                        <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                            <label for="editProductImage" style="padding: 8px 15px; background: #571c24; color: white; border-radius: 5px; cursor: pointer; font-size: 14px;">
                                <i class="fas fa-upload"></i>
                                ${product.imageUrl ? 'ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø©' : 'Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø©'}
                            </label>
                            ${product.imageUrl ? `
                                <button type="button" onclick="removeCurrentImage()" style="padding: 8px 15px; background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">
                                    <i class="fas fa-trash"></i>
                                    Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø©
                                </button>
                            ` : ''}
                            <input type="file" id="editProductImage" accept="image/*" style="display: none;" onchange="previewEditImage(event)">
                        </div>
                        <small style="color: #888; display: block; margin-top: 5px;">(Ø§Ø®ØªÙŠØ§Ø±ÙŠ - PNG, JPG, JPEG - Ø£Ù‚ØµÙ‰ 2MB)</small>
                    </div>
                    
                    <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬ -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #571c24;">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ *</label>
                            <input type="text" id="editProductName" value="${product.name || ''}" required 
                                   style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px;">
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #571c24;">Ø§Ù„Ø³Ø¹Ø± (Ø¯.Ø£) *</label>
                            <input type="number" id="editProductPrice" value="${product.price || 0}" step="0.01" required 
                                   style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px;">
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #571c24;">ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬</label>
                        <textarea id="editProductDescription" rows="4" 
                                  style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px;">${product.description || ''}</textarea>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #571c24;">Ø§Ù„ØªØµÙ†ÙŠÙ *</label>
                            <select id="editProductCategory" required 
                                    style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px;">
                                <option value="">Ø§Ø®ØªØ± ØªØµÙ†ÙŠÙØ§Ù‹</option>
                                <option value="Ø­Ø±ÙŠØ±" ${product.category === 'Ø­Ø±ÙŠØ±' ? 'selected' : ''}>Ø­Ø±ÙŠØ±</option>
                                <option value="Ù‚Ø·Ù†" ${product.category === 'Ù‚Ø·Ù†' ? 'selected' : ''}>Ù‚Ø·Ù†</option>
                                <option value="ØµÙˆÙ" ${product.category === 'ØµÙˆÙ' ? 'selected' : ''}>ØµÙˆÙ</option>
                                <option value="Ø®ÙŠØ·Ø§Ù†" ${product.category === 'Ø®ÙŠØ·Ø§Ù†' ? 'selected' : ''}>Ø®ÙŠØ·Ø§Ù†</option>
                                <option value="Ø£Ø®Ø±Ù‰" ${product.category === 'Ø£Ø®Ø±Ù‰' ? 'selected' : ''}>Ø£Ø®Ø±Ù‰</option>
                            </select>
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #571c24;">Ø§Ù„Ù…ØªØ¬Ø± *</label>
                            <select id="editProductStore" required 
                                    style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px;">
                                <option value="">Ø§Ø®ØªØ± Ù…ØªØ¬Ø±Ø§Ù‹</option>
                                <option value="Ù…ØªØ¬Ø± Ø§Ù„Ø³Ù…Ø§Ø­" ${product.store === 'Ù…ØªØ¬Ø± Ø§Ù„Ø³Ù…Ø§Ø­' ? 'selected' : ''}>Ù…ØªØ¬Ø± Ø§Ù„Ø³Ù…Ø§Ø­</option>
                                <option value="Ù…ØªØ¬Ø± Ø§Ù„ØªÙ‚Ù‰" ${product.store === 'Ù…ØªØ¬Ø± Ø§Ù„ØªÙ‚Ù‰' ? 'selected' : ''}>Ù…ØªØ¬Ø± Ø§Ù„ØªÙ‚Ù‰</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #571c24;">Ø§Ù„ÙƒÙ…ÙŠØ© ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† *</label>
                            <input type="number" id="editProductStock" value="${product.stock || 0}" required 
                                   style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px;">
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #571c24;">ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬</label>
                            <input type="text" id="editProductCode" value="${product.code || ''}" 
                                   style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px;">
                        </div>
                    </div>
                    
                    <!-- Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
                    <div id="editUploadProgress" style="display: none; margin-bottom: 20px;">
                        <div style="background: #f0f0f0; border-radius: 10px; overflow: hidden; height: 20px;">
                            <div id="editProgressBar" style="background: #571c24; height: 100%; width: 0%; transition: width 0.3s;"></div>
                        </div>
                        <p id="editProgressText" style="text-align: center; margin-top: 5px; color: #571c24;"></p>
                    </div>
                    
                    <!-- Ø£Ø²Ø±Ø§Ø± -->
                    <div style="display: flex; gap: 15px; margin-top: 30px;">
                        <button type="button" onclick="loadProductsPage()" 
                                style="flex: 1; padding: 15px; background: #f8f9fa; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; font-size: 16px;">
                            Ø¥Ù„ØºØ§Ø¡
                        </button>
                        <button type="submit" id="editSubmitBtn"
                                style="flex: 2; padding: 15px; background: linear-gradient(135deg, #571c24, #752a34); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px;">
                            <i class="fas fa-save"></i>
                            Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
                        </button>
                    </div>
                </form>
            </div>
        `;
        
        document.getElementById('contentContainer').innerHTML = formHTML;
        
        // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„Ù„Ù†Ù…ÙˆØ°Ø¬
        document.getElementById('editProductForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            await updateProductInFirebase(productId);
        });
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø±ÙŠØ± Ø§Ù„Ù…Ù†ØªØ¬:', error);
        alert(`âŒ ÙØ´Ù„ ØªØ­Ø±ÙŠØ± Ø§Ù„Ù…Ù†ØªØ¬: ${error.message}`);
    }
}

// ========== Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø© ÙÙŠ Ø§Ù„ØªØ­Ø±ÙŠØ± ==========
function previewEditImage(event) {
    const input = event.target;
    const previewDiv = document.getElementById('editImagePreview');
    const placeholder = document.getElementById('editPreviewPlaceholder');
    const existingImage = document.getElementById('editPreviewImage');
    
    if (input.files && input.files[0]) {
        const file = input.files[0];
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¬Ù… ÙˆÙ†ÙˆØ¹ Ø§Ù„ØµÙˆØ±Ø©
        if (file.size > 2 * 1024 * 1024) {
            alert('âŒ Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹! Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 2MB');
            input.value = '';
            return;
        }
        
        const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
        if (!validTypes.includes(file.type)) {
            alert('âŒ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…!');
            input.value = '';
            return;
        }
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
        const reader = new FileReader();
        reader.onload = function(e) {
            if (placeholder) placeholder.style.display = 'none';
            if (existingImage) existingImage.style.display = 'none';
            
            const img = document.createElement('img');
            img.src = e.target.result;
            img.style.maxWidth = '100%';
            img.style.maxHeight = '100%';
            img.id = 'newPreviewImage';
            
            previewDiv.appendChild(img);
        }
        reader.readAsDataURL(file);
    }
}

// ========== Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ==========
function removeCurrentImage() {
    if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©ØŸ')) {
        document.getElementById('currentImageUrl').value = '';
        const previewDiv = document.getElementById('editImagePreview');
        previewDiv.innerHTML = `
            <div id="editPreviewPlaceholder" style="text-align: center; color: #999;">
                <i class="fas fa-image" style="font-size: 50px; margin-bottom: 10px;"></i>
                <p>Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø©</p>
            </div>
        `;
        
        // Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„Ø­Ø°Ù
        const deleteBtn = document.querySelector('button[onclick="removeCurrentImage()"]');
        if (deleteBtn) deleteBtn.style.display = 'none';
        
        // Ø¥Ø®ÙØ§Ø¡ Ø­Ù‚Ù„ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙˆØ±Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
        const fileInput = document.getElementById('editProductImage');
        if (fileInput) fileInput.value = '';
    }
}

// ========== ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬ ÙÙŠ Firebase Ù…Ø¹ Ø§Ù„ØµÙˆØ±Ø© ==========
async function updateProductInFirebase(productId) {
    const submitBtn = document.getElementById('editSubmitBtn');
    const uploadProgress = document.getElementById('editUploadProgress');
    const progressBar = document.getElementById('editProgressBar');
    const progressText = document.getElementById('editProgressText');
    
    try {
        if (!db || !storage) {
            throw new Error('Firebase ØºÙŠØ± Ù…ØªØµÙ„');
        }
        
        // ØªØ¹Ø·ÙŠÙ„ Ø²Ø± Ø§Ù„Ø­ÙØ¸ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø±ÙØ¹
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
        
        // Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        const updateData = {
            name: document.getElementById('editProductName').value.trim(),
            description: document.getElementById('editProductDescription').value.trim(),
            price: parseFloat(document.getElementById('editProductPrice').value) || 0,
            stock: parseInt(document.getElementById('editProductStock').value) || 0,
            category: document.getElementById('editProductCategory').value,
            store: document.getElementById('editProductStore').value,
            code: document.getElementById('editProductCode').value.trim(),
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
        if (!updateData.name || !updateData.category || !updateData.store) {
            throw new Error('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
        }
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø©
        const imageFile = document.getElementById('editProductImage').files[0];
        const currentImageUrl = document.getElementById('currentImageUrl').value;
        
        let imageUrl = currentImageUrl; // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙƒÙ‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        
        if (imageFile) {
            // Ø¥Ø¸Ù‡Ø§Ø± Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
            uploadProgress.style.display = 'block';
            progressText.textContent = 'Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©...';
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø³Ù… ÙØ±ÙŠØ¯ Ù„Ù„ØµÙˆØ±Ø©
            const timestamp = Date.now();
            const fileName = `products/${timestamp}_${imageFile.name}`;
            
            // Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            const storageRef = storage.ref(fileName);
            const uploadTask = storageRef.put(imageFile);
            
            // Ù…ØªØ§Ø¨Ø¹Ø© ØªÙ‚Ø¯Ù… Ø§Ù„Ø±ÙØ¹
            await new Promise((resolve, reject) => {
                uploadTask.on('state_changed',
                    (snapshot) => {
                        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        progressBar.style.width = progress + '%';
                        progressText.textContent = `Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©: ${Math.round(progress)}%`;
                    },
                    (error) => {
                        reject(error);
                    },
                    async () => {
                        imageUrl = await uploadTask.snapshot.ref.getDownloadURL();
                        console.log('âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:', imageUrl);
                        resolve();
                    }
                );
            });
        }
        
        // Ø¥Ø°Ø§ ØªÙ…Øª Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØµÙˆØ±Ø© (currentImageUrl ÙØ§Ø±Øº)
        if (!currentImageUrl && !imageFile) {
            imageUrl = '';
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ­Ø¯ÙŠØ«
        updateData.imageUrl = imageUrl;
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬ ÙÙŠ Firestore
        progressText.textContent = 'Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬...';
        await db.collection('products').doc(productId).update(updateData);
        
        console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­');
        
        // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
        progressBar.style.width = '100%';
        progressText.textContent = 'âœ… ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­!';
        
        // Ø§Ù†ØªØ¸Ø§Ø± Ù‚ØµÙŠØ± Ø«Ù… Ø§Ù„Ø¹ÙˆØ¯Ø©
        setTimeout(() => {
            alert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­!');
            loadProductsPage();
        }, 1000);
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬:', error);
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø±
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª';
        
        // Ø¥Ø®ÙØ§Ø¡ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
        uploadProgress.style.display = 'none';
        
        alert(`âŒ ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬: ${error.message}`);
    }
}
// ========== ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬ ÙÙŠ Firebase ==========
async function updateProductInFirebase(productId) {
    try {
        if (!db) {
            throw new Error('Firebase ØºÙŠØ± Ù…ØªØµÙ„');
        }
        
        const updateData = {
            name: document.getElementById('editProductName').value,
            description: document.getElementById('editProductDescription').value,
            price: parseFloat(document.getElementById('editProductPrice').value),
            stock: parseInt(document.getElementById('editProductStock').value),
            category: document.getElementById('editProductCategory').value,
            store: document.getElementById('editProductStore').value,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        console.log('ğŸ“ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ­Ø¯ÙŠØ«:', updateData);
        
        await db.collection('products').doc(productId).update(updateData);
        
        console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­');
        alert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­!');
        
        // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        loadProductsPage();
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬:', error);
        alert(`âŒ ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬: ${error.message}`);
    }
}

// ========== Ø­Ø°Ù Ù…Ù†ØªØ¬ ==========
async function deleteProduct(productId, productName) {
    if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ "${productName}"ØŸ\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.`)) {
        return;
    }
    
    try {
        if (!db) {
            throw new Error('Firebase ØºÙŠØ± Ù…ØªØµÙ„');
        }
        
        // Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Firestore
        await db.collection('products').doc(productId).delete();
        
        console.log(`âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ ${productId}`);
        alert(`âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ "${productName}" Ø¨Ù†Ø¬Ø§Ø­`);
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        loadProductsData();
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬:', error);
        alert(`âŒ ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬: ${error.message}`);
    }
}

// ========== Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ ==========
// ========== Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ø¹ Ø§Ù„ØµÙˆØ±Ø© ==========
async function viewProduct(productId) {
    try {
        if (!db) {
            throw new Error('Firebase ØºÙŠØ± Ù…ØªØµÙ„');
        }
        
        const doc = await db.collection('products').doc(productId).get();
        
        if (!doc.exists) {
            alert('âŒ Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
            return;
        }
        
        const product = doc.data();
        const createdAt = product.createdAt ? product.createdAt.toDate().toLocaleDateString('ar-EG') : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
        const updatedAt = product.updatedAt ? product.updatedAt.toDate().toLocaleDateString('ar-EG') : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
        
        // ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬
        const imageHTML = product.imageUrl 
            ? `<img src="${product.imageUrl}" alt="${product.name}" style="max-width: 100%; max-height: 300px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">`
            : `<div style="height: 200px; background: linear-gradient(135deg, #f5f7fa, #c3cfe2); border-radius: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #666;">
                  <i class="fas fa-image" style="font-size: 60px; margin-bottom: 15px;"></i>
                  <p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±Ø© Ù„Ù„Ù…Ù†ØªØ¬</p>
               </div>`;
        
        const detailsHTML = `
            <div style="background: white; padding: 30px; border-radius: 10px; max-width: 800px; margin: 0 auto;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h3 style="color: #571c24; margin: 0;">
                        <i class="fas fa-info-circle"></i>
                        ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬
                    </h3>
                    <button onclick="loadProductsPage()" style="background: #f8f9fa; border: 1px solid #ddd; padding: 8px 15px; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-arrow-right"></i> Ø±Ø¬ÙˆØ¹
                    </button>
                </div>
                
                <!-- ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ -->
                <div style="text-align: center; margin-bottom: 30px;">
                    ${imageHTML}
                </div>
                
                <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬ -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                        <h4 style="color: #571c24; margin-bottom: 10px;">${product.name}</h4>
                        <p style="color: #666; line-height: 1.6;">${product.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ'}</p>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <p style="margin: 0 0 5px; color: #2c3e50;"><strong>Ø§Ù„Ø³Ø¹Ø±:</strong></p>
                                <p style="margin: 0; font-size: 24px; font-weight: bold; color: #571c24;">
                                    ${parseFloat(product.price || 0).toFixed(2)} Ø¯.Ø£
                                </p>
                            </div>
                            
                            <div style="background: ${product.stock > 10 ? '#d4edda' : product.stock > 0 ? '#fff3cd' : '#f8d7da'}; 
                                  padding: 15px; border-radius: 8px;">
                                <p style="margin: 0 0 5px; color: ${product.stock > 10 ? '#155724' : product.stock > 0 ? '#856404' : '#721c24'}"><strong>Ø§Ù„Ù…Ø®Ø²ÙˆÙ†:</strong></p>
                                <p style="margin: 0; font-size: 24px; font-weight: bold;">
                                    ${product.stock || 0}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 25px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div>
                            <p style="margin: 5px 0;"><strong>Ø§Ù„ØªØµÙ†ÙŠÙ:</strong> ${product.category || 'ØºÙŠØ± Ù…ØµÙ†Ù'}</p>
                            <p style="margin: 5px 0;"><strong>Ø§Ù„Ù…ØªØ¬Ø±:</strong> ${product.store || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                        </div>
                        <div>
                            <p style="margin: 5px 0;"><strong>ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬:</strong> ${product.code || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</p>
                            <p style="margin: 5px 0;"><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©:</strong> ${createdAt}</p>
                            <p style="margin: 5px 0;"><strong>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:</strong> ${updatedAt}</p>
                        </div>
                    </div>
                </div>
                
                <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
                <div style="display: flex; gap: 15px;">
                    <button onclick="loadProductsPage()" 
                            style="flex: 1; padding: 15px; background: #6c757d; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px;">
                        <i class="fas fa-arrow-right"></i>
                        Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª
                    </button>
                    <button onclick="editProduct('${productId}')" 
                            style="flex: 1; padding: 15px; background: #571c24; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px;">
                        <i class="fas fa-edit"></i>
                        ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬
                    </button>
                    <button onclick="downloadImage('${product.imageUrl}', '${product.name}')" 
                            ${!product.imageUrl ? 'disabled style="opacity: 0.5;"' : 'style="flex: 1; padding: 15px; background: #28a745; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px;"'}>
                        <i class="fas fa-download"></i>
                        ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
                    </button>
                </div>
            </div>
        `;
        
        document.getElementById('contentContainer').innerHTML = detailsHTML;
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬:', error);
        alert(`âŒ ÙØ´Ù„ Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„: ${error.message}`);
    }
}

// ========== ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© ==========
function downloadImage(imageUrl, productName) {
    if (!imageUrl) {
        alert('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±Ø© Ù„Ù„ØªØ­Ù…ÙŠÙ„');
        return;
    }
    
    const link = document.createElement('a');
    link.href = imageUrl;
    link.download = `product_${productName}_${Date.now()}.jpg`;
    link.target = '_blank';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    alert('âœ… Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©...');
} 

// ========== Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ==========
async function searchProducts() {
    const searchTerm = document.getElementById('searchProduct').value.toLowerCase();
    const category = document.getElementById('filterCategory').value;
    const store = document.getElementById('filterStore').value;
    
    console.log('ğŸ” Ø¨Ø­Ø« Ø¹Ù†:', { searchTerm, category, store });
    
    try {
        if (!db) {
            throw new Error('Firebase ØºÙŠØ± Ù…ØªØµÙ„');
        }
        
        let query = db.collection('products');
        
        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ± Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
        if (searchTerm) {
            query = query.where('name', '>=', searchTerm)
                        .where('name', '<=', searchTerm + '\uf8ff');
        }
        
        const snapshot = await query.get();
        
        let products = [];
        snapshot.forEach(doc => {
            const product = doc.data();
            products.push({
                id: doc.id,
                ...product
            });
        });
        
        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ± Ù…Ø­Ù„ÙŠØ§Ù‹ (ÙŠÙ…ÙƒÙ† ØªØ­Ø³ÙŠÙ†Ù‡Ø§ Ø¨ÙÙ„Ø§ØªØ± Firestore)
        if (category) {
            products = products.filter(p => p.category === category);
        }
        
        if (store) {
            products = products.filter(p => p.store === store);
        }
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        displayProducts(products);
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø«:', error);
        alert('âŒ ÙØ´Ù„ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª');
    }
}
// ========== Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© ÙÙŠ Firebase ==========
async function createSampleProducts() {
    if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ù…Ù†ØªØ¬Ø§ØªØŸ\nØ³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© 5 Ù…Ù†ØªØ¬Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©.')) {
        return;
    }
    
    try {
        if (!db) {
            throw new Error('Firebase ØºÙŠØ± Ù…ØªØµÙ„');
        }
        
        const sampleProducts = [
            {
                name: 'Ø¬Ø±Ø§Ø¨Ø§Øª Ø­Ø±ÙŠØ± ÙØ§Ø®Ø±Ø©',
                description: 'Ø¬Ø±Ø§Ø¨Ø§Øª Ù…ØµÙ†ÙˆØ¹Ø© Ù…Ù† Ø§Ù„Ø­Ø±ÙŠØ± Ø§Ù„ÙØ§Ø®Ø± Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¬ÙˆØ¯Ø©',
                price: 99.99,
                category: 'Ø­Ø±ÙŠØ±',
                stock: 15,
                store: 'Ù…ØªØ¬Ø± Ø§Ù„Ø³Ù…Ø§Ø­',
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            },
            {
                name: 'Ø´Ø§Ù„Ø§Øª Ø­Ø±ÙŠØ± Ø£Ù†ÙŠÙ‚Ø©',
                description: 'Ø´Ø§Ù„Ø§Øª Ù…ØµÙ…Ù…Ø© Ø¨Ø£Ù†Ø§Ù‚Ø© Ù…Ù† Ø§Ù„Ø­Ø±ÙŠØ± Ø§Ù„Ø®Ø§Ù„Øµ',
                price: 149.99,
                category: 'Ø­Ø±ÙŠØ±',
                stock: 8,
                store: 'Ù…ØªØ¬Ø± Ø§Ù„ØªÙ‚Ù‰',
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            },
            {
                name: 'Ø¬Ø±Ø§Ø¨Ø§Øª Ù‚Ø·Ù† Ù…Ø±ÙŠØ­Ø©',
                description: 'Ø¬Ø±Ø§Ø¨Ø§Øª Ù…Ø±ÙŠØ­Ø© Ù…ØµÙ†ÙˆØ¹Ø© Ù…Ù† Ø§Ù„Ù‚Ø·Ù† Ø§Ù„Ù…ØµØ±ÙŠ',
                price: 49.99,
                category: 'Ù‚Ø·Ù†',
                stock: 25,
                store: 'Ù…ØªØ¬Ø± Ø§Ù„Ø³Ù…Ø§Ø­',
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            },
            {
                name: 'Ø´Ø§Ù„Ø§Øª Ù‚Ø·Ù† Ù†Ø§Ø¹Ù…Ø©',
                description: 'Ø´Ø§Ù„Ø§Øª Ù†Ø§Ø¹Ù…Ø© Ù…Ù† Ø§Ù„Ù‚Ø·Ù† Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¬ÙˆØ¯Ø©',
                price: 79.99,
                category: 'Ù‚Ø·Ù†',
                stock: 12,
                store: 'Ù…ØªØ¬Ø± Ø§Ù„ØªÙ‚Ù‰',
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            },
            {
                name: 'Ø¬Ø±Ø§Ø¨Ø§Øª Ø­Ø±ÙŠØ± Ù…Ø·Ø±Ø²Ø©',
                description: 'Ø¬Ø±Ø§Ø¨Ø§Øª Ø­Ø±ÙŠØ± Ù…Ø¹ ØªØ·Ø±ÙŠØ² ÙŠØ¯ÙˆÙŠ ÙØ§Ø®Ø±',
                price: 129.99,
                category: 'Ø­Ø±ÙŠØ±',
                stock: 5,
                store: 'Ù…ØªØ¬Ø± Ø§Ù„Ø³Ù…Ø§Ø­',
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            }
        ];
        
        // Ø¥Ø¶Ø§ÙØ© ÙƒÙ„ Ù…Ù†ØªØ¬
        const promises = sampleProducts.map(product => db.collection('products').add(product));
        await Promise.all(promises);
        
        alert('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!');
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        loadProductsData();
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©:', error);
        alert(`âŒ ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${error.message}`);
    }
}

// Ø£Ø¶Ù Ù‡Ø°Ø§ Ø§Ù„Ø²Ø± ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
function addSampleDataButton() {
    const buttonHTML = `
        <button onclick="createSampleProducts()" style="background: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 5px; margin-right: 10px; cursor: pointer;">
            <i class="fas fa-vial"></i>
            Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
        </button>
    `;
    
    // Ø£Ø¶Ù Ø§Ù„Ø²Ø± Ø¨Ø¬Ø§Ù†Ø¨ Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ©
    const pageHeader = document.querySelector('.page-header');
    if (pageHeader) {
        pageHeader.innerHTML += buttonHTML;
    }
}
// ========== Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ==========
function closeForm() {
    loadProductsPage();
}
        // ========== Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰ ==========
        function loadOrdersPage() {
            document.getElementById('contentContainer').innerHTML = `
                <div class="content-box">
                    <h2 class="page-title">
                        <i class="fas fa-shopping-cart"></i>
                        Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª
                    </h2>
                    <p>ØµÙØ­Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±...</p>
                </div>
            `;
        }
        
        function loadReportsPage() {
            document.getElementById('contentContainer').innerHTML = `
                <div class="content-box">
                    <h2 class="page-title">
                        <i class="fas fa-chart-bar"></i>
                        Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                    </h2>
                    <p>ØµÙØ­Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±...</p>
                </div>
            `;
        }
        
        function loadSettingsPage() {
            document.getElementById('contentContainer').innerHTML = `
                <div class="content-box">
                    <h2 class="page-title">
                        <i class="fas fa-cog"></i>
                        Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
                    </h2>
                    <p>ØµÙØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±...</p>
                </div>
            `;
        }
    </script>
</body>
</html>